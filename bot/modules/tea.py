from brain import random, asyncio, types, InlineKeyboardMarkup, InlineKeyboardButton, logging

def register(dp):
    @dp.message_handler(lambda message: message.text and message.text.strip().lower() in ["—á–∞–π", "—Ü–∞–π"])
    async def make_tea(message: types.Message):
        username = message.from_user.first_name or message.from_user.username or "–¥—Ä—É–≥ —á–∞—è"

        # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ —á–∞—è
        tea_keyboard = InlineKeyboardMarkup(row_width=2)
        tea_keyboard.add(
            InlineKeyboardButton("1Ô∏è‚É£ –ß–µ—Ä–Ω—ã–π —á–∞–π", callback_data="tea_black"),
            InlineKeyboardButton("2Ô∏è‚É£ –ó–µ–ª–µ–Ω—ã–π —á–∞–π", callback_data="tea_green"),
            InlineKeyboardButton("3Ô∏è‚É£ –ú—è—Ç–Ω—ã–π —á–∞–π", callback_data="tea_mint"),
            InlineKeyboardButton("4Ô∏è‚É£ –ß–∞–π–Ω—ã–π –Ω–∞–±–æ—Ä (—Å —á–∞–µ–º –∏ —Å–ª–∞–¥–æ—Å—Ç—è–º–∏)", callback_data="tea_full")
        )

        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —á–∞—è
        await message.reply(
            f"ü´ñ –ü—Ä–∏–≤–µ—Ç, {username}! –°–µ–π—á–∞—Å —è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª—é —Ç–µ–±–µ –æ—Å–æ–±–µ–Ω–Ω—ã–π –∞–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω—Å–∫–∏–π —á–∞–π. –ö–∞–∫–æ–π –≤–∏–¥ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—à—å?",
            reply_markup=tea_keyboard
        )

    @dp.callback_query_handler(lambda c: c.data and c.data.startswith("tea_"))
    async def tea_selection(callback_query: types.CallbackQuery):
        tea_types = {
            "tea_black": "—á–µ—Ä–Ω—ã–π —á–∞–π",
            "tea_green": "–∑–µ–ª–µ–Ω—ã–π —á–∞–π",
            "tea_mint": "–º—è—Ç–Ω—ã–π —á–∞–π",
            "tea_full": "—á–∞–π–Ω—ã–π –Ω–∞–±–æ—Ä (—Å —á–∞–µ–º –∏ —Å–ª–∞–¥–æ—Å—Ç—è–º–∏)"
        }
        tea_type = tea_types.get(callback_query.data, "—á–∞–π")

        username = callback_query.from_user.first_name or callback_query.from_user.username or "–¥—Ä—É–≥ —á–∞—è"

        # –ü–æ—à–∞–≥–æ–≤–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ —á–∞—è
        steps = [
            f"üçÉ {username}, –≤—ã–±–∏—Ä–∞—é —Å–∞–º—ã–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∞–π–Ω—ã–µ –ª–∏—Å—Ç—å—è...",
            "üçµ –û–ø–æ–ª–∞—Å–∫–∏–≤–∞—é —á–∞–π–Ω–∏–∫ –≥–æ—Ä—è—á–µ–π –≤–æ–¥–æ–π, —á—Ç–æ–±—ã —á–∞–π –±—ã–ª –≤–∫—É—Å–Ω–µ–µ...",
            "üî• –í–æ–¥–∞ –∫–∏–ø–∏—Ç, –∫–æ–º–Ω–∞—Ç–∞ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Ä–æ–º–∞—Ç–æ–º –∞–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω—Å–∫–æ–≥–æ —á–∞—è...",
            f"‚ú® –ó–∞–≤–∞—Ä–∏–≤–∞—é {tea_type} —Å –ª—é–±–æ–≤—å—é –∏ —Ç–µ–ø–ª—ã–º–∏ —á—É–≤—Å—Ç–≤–∞–º–∏ –¥–ª—è —Ç–µ–±—è...",
            "‚è≥ –ñ–¥—ë–º, –ø–æ–∫–∞ —á–∞–π –∑–∞–≤–∞—Ä–∏—Ç—Å—è, —á—Ç–æ–±—ã –≤–∫—É—Å —Å—Ç–∞–ª –Ω–∞—Å—ã—â–µ–Ω–Ω–µ–µ...",
            f"ü´ñ –ß–∞–π –≥–æ—Ç–æ–≤! –†–∞–∑–ª–∏–≤–∞—é –µ–≥–æ –≤ —Å—Ç–∞–∫–∞–Ω—ã —Å —Ç–æ–Ω–∫–∏–º —Å—Ç–µ–∫–ª–æ–º."
        ]

        for step in steps:
            await callback_query.message.answer(step)
            await asyncio.sleep(2)

        # –°–æ–≤–µ—Ç—ã –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —á–∞–µ–ø–∏—Ç–∏—è
        tea_tips = [
            "üçØ –î–æ–±–∞–≤—å –Ω–µ–º–Ω–æ–≥–æ –º—ë–¥–∞ –≤ —á–∞–π, —ç—Ç–æ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è.",
            "üçã –î–æ–ª—å–∫–∞ –ª–∏–º–æ–Ω–∞ —Å–¥–µ–ª–∞–µ—Ç —á–∞–π –±–æ–ª–µ–µ –æ—Å–≤–µ–∂–∞—é—â–∏–º.",
            "üç™ –°–ª–∞–¥–æ—Å—Ç–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ —à–∞–∫–µ—Ä–±—É—Ä–∞ –∏ –ø–∞—Ö–ª–∞–≤–∞, –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –∫ —á–∞—é.",
            "üé∂ –°–ª—É—à–∞–π —Å–≤–æ—é –ª—é–±–∏–º—É—é –º—É–∑—ã–∫—É –≤–æ –≤—Ä–µ–º—è —á–∞–µ–ø–∏—Ç–∏—è, –∏ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ —É–¥–≤–æ–∏—Ç—Å—è."
        ]

        # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        warm_message = (
            f"ü•∞ –í–æ—Ç —Ç–≤–æ–π {tea_type}, {username}! –ü–µ–π —á–∞–π —Å –º—ë–¥–æ–º, –ª–∏–º–æ–Ω–æ–º –∏–ª–∏ —Å–ª–∞–¥–æ—Å—Ç—è–º–∏. "
            "–ñ–µ–ª–∞—é —Ç–µ–±–µ —É—é—Ç–∞ –∏ —Ö–æ—Ä–æ—à–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è. –ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å, —è –≤—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º. üåü"
        )
        await callback_query.message.answer(warm_message)

        encouragements = [
            "üåº –í –∫–∞–∂–¥–æ–π —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –µ—Å—Ç—å —Å–≤–æ—è –æ—Ç—Ä–∞–¥–∞.",
            "üåû –í—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –∫–∞–∂–µ—Ç—Å—è –∏–Ω–∞—á–µ.",
            "üçÇ –ò–Ω–æ–≥–¥–∞ –ª—É—á—à–∏–π –æ—Ç–≤–µ—Ç ‚Äî —ç—Ç–æ –ø–∞—É–∑–∞ —Å —á–∞—à–∫–æ–π —á–∞—è.",
            "‚ú® –¢—ã –æ—á–µ–Ω—å —Ü–µ–Ω–µ–Ω, –Ω–µ –∑–∞–±—ã–≤–∞–π –æ–± —ç—Ç–æ–º."
        ]

        # –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º —Å–æ–≤–µ—Ç–æ–º –∏ –ø–æ–∂–µ–ª–∞–Ω–∏–µ–º
        final_message = (
            f"üí° –°–æ–≤–µ—Ç: {random.choice(tea_tips)}\n"
            f"‚ú® {random.choice(encouragements)}"
        )
        await callback_query.message.answer(final_message)

logging.debug("–ú–æ–¥—É–ª—å tea: —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.")